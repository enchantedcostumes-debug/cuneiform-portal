<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Tammy L Casey">
    <meta name="copyright" content="Copyright 2026 Tammy L Casey. All rights reserved.">
    <meta name="motto" content="Known by our fruits - not our roots">
    <title>CUNEIFORM - Ancient Writing Decoded | Ozark Oracle</title>
    <meta name="description" content="Explore 4,000 years of cuneiform writing. 93,421 tablets, 48,080 words, 2,093 signs. OCR analysis, concordance, word study, sign charts, and learning tools.">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Cuneiform&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="stylesheet-cuneiform.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="nav.css">
</head>
<body>
<script src="load_nav.js"></script>

<main id="main-content" class="page-container">
    <div class="page-header">
        <div class="cuneiform-glyph-lg">&#x12000; &#x12038; &#x120AD;</div>
        <h1 class="text-gold">CUNEIFORM</h1>
        <p class="text-silver">4,000 Years of Human Writing - Decoded</p>
    </div>

    <div class="stats-grid" id="stats-bar">
        <div class="stat-box">
            <div class="stat-value text-gold" id="stat-tablets">93,421</div>
            <div class="stat-label">Tablets</div>
        </div>
        <div class="stat-box">
            <div class="stat-value text-gold" id="stat-words">48,080</div>
            <div class="stat-label">Words Indexed</div>
        </div>
        <div class="stat-box">
            <div class="stat-value text-gold" id="stat-signs">2,093</div>
            <div class="stat-label">Signs</div>
        </div>
        <div class="stat-box">
            <div class="stat-value text-gold" id="stat-corpora">33</div>
            <div class="stat-label">Corpora</div>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="tab-bar">
        <button class="tab-btn active" onclick="showTab('search')">Word Search</button>
        <button class="tab-btn" onclick="showTab('signs')">Sign Chart</button>
        <button class="tab-btn" onclick="showTab('library')">Tablet Library</button>
        <button class="tab-btn" onclick="showTab('concordance')">Concordance</button>
        <button class="tab-btn" onclick="showTab('learn')">Learn</button>
    </div>

    <!-- TAB: Word Search -->
    <div id="tab-search" class="tab-content active">
        <div class="search-container">
            <input type="text" class="search-box" id="word-search" placeholder="Search Sumerian or Akkadian words... (e.g. lugal, dingir, anu)" oninput="debounceSearch()">
        </div>
        <div class="results-area" id="search-results">
            <p class="loading">Type a word to search 48,080 indexed lemmas</p>
        </div>
    </div>

    <!-- TAB: Sign Chart -->
    <div id="tab-signs" class="tab-content">
        <h2 class="text-gold">Cuneiform Sign Chart</h2>
        <p class="text-silver">2,093 signs from the Sumerian and Akkadian writing systems</p>
        <div class="search-container">
            <input type="text" class="search-box" id="sign-search" placeholder="Filter signs by name..." oninput="filterSigns()">
        </div>
        <div class="sign-grid" id="sign-grid">
            <p class="loading">Loading signs...</p>
        </div>
        <div class="pagination" id="sign-pagination"></div>
    </div>

    <!-- TAB: Tablet Library -->
    <div id="tab-library" class="tab-content">
        <h2 class="text-gold">Tablet Library</h2>
        <p class="text-silver">Browse 93,421 cuneiform tablets from 33 corpora</p>
        <div style="display:flex;gap:1rem;margin:1rem 0;flex-wrap:wrap;">
            <select id="lib-period" class="search-box" style="width:auto;flex:1;min-width:150px;" onchange="loadTablets()">
                <option value="">All Periods</option>
            </select>
            <select id="lib-genre" class="search-box" style="width:auto;flex:1;min-width:150px;" onchange="loadTablets()">
                <option value="">All Genres</option>
            </select>
            <input type="text" class="search-box" id="lib-search" placeholder="Search titles..." style="flex:2;min-width:200px;" oninput="debounceLibrary()">
        </div>
        <div id="library-results">
            <p class="loading">Loading tablets...</p>
        </div>
        <div class="pagination" id="lib-pagination"></div>
    </div>

    <!-- TAB: Concordance -->
    <div id="tab-concordance" class="tab-content">
        <h2 class="text-gold">Word Concordance</h2>
        <p class="text-silver">Trace any word across 4,000 years of texts</p>
        <div class="search-container">
            <input type="text" class="search-box" id="conc-search" placeholder="Enter a Sumerian word (e.g. lugal, an, e2)..." onkeydown="if(event.key==='Enter')searchConcordance()">
        </div>
        <div id="conc-results">
            <p class="loading">Search for a word to see its occurrences across all tablets</p>
        </div>
    </div>

    <!-- TAB: Learn -->
    <div id="tab-learn" class="tab-content">
        <h2 class="text-gold">Learn Cuneiform</h2>
        <p class="text-silver">Start your journey into the world's oldest writing system</p>
        <div class="feature-grid">
            <div class="feature-card" onclick="showTab('signs');document.querySelector('[onclick*=signs]').classList.add('active');">
                <div class="card-icon cuneiform-glyph">&#x12000;</div>
                <h3>Sign Chart</h3>
                <p>Browse all 2,093 cuneiform signs with readings and classifications</p>
            </div>
            <div class="feature-card" onclick="showTab('search');document.querySelector('[onclick*=search]').classList.add('active');">
                <div class="card-icon">A-Z</div>
                <h3>Word Search</h3>
                <p>Search 48,080 lemmas across the entire corpus</p>
            </div>
            <div class="feature-card" onclick="showTab('concordance');document.querySelector('[onclick*=concordance]').classList.add('active');">
                <div class="card-icon">[+]</div>
                <h3>Concordance</h3>
                <p>Trace any word across 4,000 years of texts with period distribution</p>
            </div>
            <div class="feature-card" onclick="showTab('library');document.querySelector('[onclick*=library]').classList.add('active');">
                <div class="card-icon">[=]</div>
                <h3>Tablet Library</h3>
                <p>Browse 102,511 tablets by period, genre, and keyword</p>
            </div>
            <div class="feature-card">
                <div class="card-icon">[~]</div>
                <h3>Sumerian Grammar</h3>
                <p>Agglutinative language: noun + case suffix. SOV word order. Ergative alignment.</p>
            </div>
            <div class="feature-card">
                <div class="card-icon">[*]</div>
                <h3>Writing System</h3>
                <p>Logographic + syllabic. Reed stylus on wet clay. 2,093 signs encode Sumerian and Akkadian.</p>
            </div>
        </div>
    </div>

    <div class="panel" style="margin-top:2rem;">
        <h3 class="text-gold">About This Collection</h3>
        <p class="text-silver">This corpus contains transliterations from the Open Richly Annotated Cuneiform Corpus (ORACC), spanning from the Early Dynastic period (~2900 BCE) through the Neo-Babylonian period (~539 BCE). Every tablet has been indexed, every word lemmatized, every sign catalogued. The concordance traces word usage across 4,000 years of human civilization -- the longest continuous writing tradition in history.</p>
        <p class="text-silver" style="margin-top:0.5rem;font-size:0.85rem;">Data: ORACC (CC BY-SA 3.0) | Platform: Ozark Oracle | Copyright 2026 Tammy L Casey</p>
    </div>
</main>

<script>
/* =====================================================================
   CUNEIFORM PORTAL - 100% Static Data (Bible Pattern)
   All data pre-built as JSON. Zero API calls. Zero cross-origin requests.
   ===================================================================== */

// Data caches (loaded lazily per tab)
let concData = null;    // 48,080 concordance entries
let signData = [];      // 2,093 signs
let tabletData = null;  // 102,511 tablets
let filterData = null;  // period/genre options
let statsData = null;   // corpus statistics

let searchTimeout = null;
let libTimeout = null;
let signPage = 1;
let libPage = 1;
const SIGNS_PER_PAGE = 60;
const TABLETS_PER_PAGE = 25;

function esc(s) {
    if (!s) return '';
    return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

// ---- Tab switching ----
function showTab(tabId) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('tab-' + tabId).classList.add('active');
    event.target.classList.add('active');

    if (tabId === 'signs' && signData.length === 0) loadSigns();
    if (tabId === 'library' && !tabletData) loadLibrary();
    if (tabId === 'concordance' && !concData) loadConcordanceData();
}

// ---- Stats (loaded on page init) ----
async function loadStats() {
    try {
        const resp = await fetch('data/stats.json');
        statsData = await resp.json();
        if (statsData.total_tablets) document.getElementById('stat-tablets').textContent = statsData.total_tablets.toLocaleString();
        if (statsData.total_lemmas) document.getElementById('stat-words').textContent = statsData.total_lemmas.toLocaleString();
        if (statsData.total_signs) document.getElementById('stat-signs').textContent = statsData.total_signs.toLocaleString();
    } catch(e) { /* use hardcoded defaults in HTML */ }
}

// ---- Concordance data (shared by Word Search + Concordance tabs) ----
async function ensureConcData() {
    if (concData) return;
    const resp = await fetch('data/concordance.json');
    concData = await resp.json();
}

// ---- Word Search tab ----
function debounceSearch() {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(searchWords, 300);
}

async function searchWords() {
    const q = document.getElementById('word-search').value.trim().toLowerCase();
    const area = document.getElementById('search-results');
    if (q.length < 2) {
        area.innerHTML = '<p class="loading">Type at least 2 characters to search</p>';
        return;
    }
    area.innerHTML = '<p class="loading">Searching...</p>';
    try {
        await ensureConcData();
        const results = concData.filter(r =>
            (r.lemma && r.lemma.toLowerCase().includes(q)) ||
            (r.gloss && r.gloss.toLowerCase().includes(q))
        ).slice(0, 30);

        if (results.length === 0) {
            area.innerHTML = '<p class="loading">No results for "' + esc(q) + '"</p>';
            return;
        }
        let html = '';
        results.forEach(r => {
            html += '<div class="result-item" onclick="showWordDetail(\'' + encodeURIComponent(r.lemma) + '\')">';
            html += '<span class="result-word">' + esc(r.lemma) + '</span>';
            html += '<span class="result-gloss"> - ' + esc(r.gloss || '') + '</span>';
            html += '<div class="result-meta">' + (r.occurrence_count || 0).toLocaleString() + ' occurrences in ' + (r.tablet_count || 0).toLocaleString() + ' tablets</div>';
            html += '</div>';
        });
        area.innerHTML = html;
    } catch(e) {
        area.innerHTML = '<p class="error-msg">Could not load concordance data.</p>';
    }
}

// Word detail view (client-side lookup)
async function showWordDetail(lemmaEncoded) {
    const lemma = decodeURIComponent(lemmaEncoded);
    const area = document.getElementById('search-results');
    area.innerHTML = '<p class="loading">Loading word detail...</p>';
    try {
        await ensureConcData();
        const w = concData.find(r => r.lemma === lemma);
        if (!w) {
            area.innerHTML = '<p class="error-msg">Word not found</p>';
            return;
        }
        let periods = w.period_json || {};
        if (typeof periods === 'string') try { periods = JSON.parse(periods); } catch(e) { periods = {}; }

        let maxCount = Math.max(...Object.values(periods), 1);
        let barsHtml = '';
        Object.entries(periods).sort((a,b) => b[1] - a[1]).forEach(([period, count]) => {
            let pct = Math.round((count / maxCount) * 100);
            barsHtml += '<div class="period-bar"><span class="period-label">' + esc(period) + '</span>';
            barsHtml += '<div class="period-fill" style="width:' + pct + '%;"></div>';
            barsHtml += '<span class="period-count">' + count.toLocaleString() + '</span></div>';
        });

        let genres = w.genre_json || {};
        if (typeof genres === 'string') try { genres = JSON.parse(genres); } catch(e) { genres = {}; }
        let genreHtml = '';
        let maxGenre = Math.max(...Object.values(genres), 1);
        Object.entries(genres).sort((a,b) => b[1] - a[1]).slice(0, 8).forEach(([g, c]) => {
            let pct = Math.round((c / maxGenre) * 100);
            genreHtml += '<div class="period-bar"><span class="period-label">' + esc(g) + '</span>';
            genreHtml += '<div class="period-fill" style="width:' + pct + '%;background:var(--silver,#C0C0C0);"></div>';
            genreHtml += '<span class="period-count">' + c.toLocaleString() + '</span></div>';
        });

        let html = '<div class="word-detail">';
        html += '<div style="display:flex;align-items:center;gap:1rem;">';
        html += '<div><h2>' + esc(w.lemma) + '</h2>';
        html += '<div class="gloss">' + esc(w.gloss || 'unknown') + '</div>';
        if (w.pos) html += '<div class="result-meta">' + esc(w.pos) + (w.semantic_category ? ' | ' + esc(w.semantic_category) : '') + '</div>';
        html += '</div></div>';
        html += '<div class="stats-grid" style="margin:1rem 0;">';
        html += '<div class="stat-box"><div class="stat-value text-gold">' + (w.occurrence_count || 0).toLocaleString() + '</div><div class="stat-label">Occurrences</div></div>';
        html += '<div class="stat-box"><div class="stat-value text-gold">' + (w.tablet_count || 0).toLocaleString() + '</div><div class="stat-label">Tablets</div></div>';
        if (w.period_first_seen) html += '<div class="stat-box"><div class="stat-value text-gold" style="font-size:0.9rem;">' + esc(w.period_first_seen) + '</div><div class="stat-label">First Attested</div></div>';
        html += '</div>';
        if (barsHtml) {
            html += '<h3 class="text-gold" style="margin:1rem 0 0.5rem;">Period Distribution</h3>';
            html += barsHtml;
        }
        if (genreHtml) {
            html += '<h3 class="text-gold" style="margin:1rem 0 0.5rem;">Genre Distribution</h3>';
            html += genreHtml;
        }
        html += '</div>';
        html += '<button class="page-btn" onclick="document.getElementById(\'word-search\').dispatchEvent(new Event(\'input\'))" style="margin-top:0.5rem;">&lt; Back to results</button>';
        area.innerHTML = html;
    } catch(e) {
        area.innerHTML = '<p class="error-msg">Failed to load word detail</p>';
    }
}

// ---- Sign Chart tab ----
async function loadSigns() {
    const grid = document.getElementById('sign-grid');
    grid.innerHTML = '<p class="loading">Loading 2,093 signs...</p>';
    try {
        const resp = await fetch('data/signs.json');
        signData = await resp.json();
        renderSigns();
    } catch(e) {
        grid.innerHTML = '<p class="error-msg">Could not load signs data.</p>';
    }
}

function renderSigns() {
    const grid = document.getElementById('sign-grid');
    const filter = (document.getElementById('sign-search').value || '').toLowerCase();
    let filtered = signData;
    if (filter) filtered = signData.filter(s =>
        (s.sign_name || '').toLowerCase().includes(filter) ||
        (s.primary_reading || '').toLowerCase().includes(filter) ||
        (s.all_readings || '').toLowerCase().includes(filter)
    );

    const start = (signPage - 1) * SIGNS_PER_PAGE;
    const page = filtered.slice(start, start + SIGNS_PER_PAGE);
    const totalPages = Math.ceil(filtered.length / SIGNS_PER_PAGE);

    let html = '';
    page.forEach(s => {
        let name = s.sign_name || '?';
        let reading = s.primary_reading || '';
        let type = s.sign_type || '';
        html += '<div class="sign-card" title="' + esc(name) + ' [' + esc(reading) + ']">';
        html += '<div class="sign-name" style="font-size:1.1rem;font-weight:bold;">' + esc(name) + '</div>';
        html += '<div class="sign-name" style="font-size:0.85rem;color:var(--gold,#D4AF37);">' + esc(reading) + '</div>';
        if (type && type !== 'atomic') html += '<div class="sign-name" style="font-size:0.7rem;opacity:0.6;">' + esc(type) + '</div>';
        html += '</div>';
    });
    grid.innerHTML = html || '<p class="loading">No signs match filter</p>';

    let pHtml = '';
    if (totalPages > 1) {
        if (signPage > 1) pHtml += '<button class="page-btn" onclick="signPage--;renderSigns();">&lt;</button>';
        pHtml += '<span class="page-btn active">' + signPage + ' / ' + totalPages + ' (' + filtered.length.toLocaleString() + ' signs)</span>';
        if (signPage < totalPages) pHtml += '<button class="page-btn" onclick="signPage++;renderSigns();">&gt;</button>';
    }
    document.getElementById('sign-pagination').innerHTML = pHtml;
}

function filterSigns() { signPage = 1; renderSigns(); }

// ---- Tablet Library tab ----
async function loadLibrary() {
    const area = document.getElementById('library-results');
    area.innerHTML = '<p class="loading">Loading 102,511 tablets...</p>';
    try {
        const [tabResp, filtResp] = await Promise.all([
            fetch('data/tablets.json'),
            fetch('data/filters.json')
        ]);
        tabletData = await tabResp.json();
        filterData = await filtResp.json();

        // Populate filter dropdowns
        const periodSel = document.getElementById('lib-period');
        const genreSel = document.getElementById('lib-genre');
        (filterData.periods || []).forEach(p => {
            periodSel.innerHTML += '<option value="' + esc(p) + '">' + esc(p) + '</option>';
        });
        (filterData.genres || []).forEach(g => {
            genreSel.innerHTML += '<option value="' + esc(g) + '">' + esc(g) + '</option>';
        });

        renderTablets();
    } catch(e) {
        area.innerHTML = '<p class="error-msg">Could not load tablet data.</p>';
    }
}

function debounceLibrary() {
    clearTimeout(libTimeout);
    libTimeout = setTimeout(function() { libPage = 1; renderTablets(); }, 400);
}

function loadTablets(page) {
    if (page) libPage = page; else libPage = 1;
    renderTablets();
}

function renderTablets() {
    if (!tabletData) return;
    const area = document.getElementById('library-results');
    const period = document.getElementById('lib-period').value;
    const genre = document.getElementById('lib-genre').value;
    const q = (document.getElementById('lib-search').value || '').trim().toLowerCase();

    let filtered = tabletData;
    if (period) filtered = filtered.filter(t => t.period === period);
    if (genre) filtered = filtered.filter(t => t.genre === genre);
    if (q) filtered = filtered.filter(t =>
        (t.title && t.title.toLowerCase().includes(q)) ||
        (t.textid && t.textid.toLowerCase().includes(q)) ||
        (t.corpus && t.corpus.toLowerCase().includes(q))
    );

    const total = filtered.length;
    const totalPages = Math.ceil(total / TABLETS_PER_PAGE);
    if (libPage > totalPages && totalPages > 0) libPage = totalPages;
    const start = (libPage - 1) * TABLETS_PER_PAGE;
    const page = filtered.slice(start, start + TABLETS_PER_PAGE);

    if (page.length === 0) {
        area.innerHTML = '<p class="loading">No tablets found</p>';
        document.getElementById('lib-pagination').innerHTML = '';
        return;
    }

    let html = '<div class="tablet-row tablet-header"><span>Title</span><span>Period</span><span>Genre</span><span>Lines</span></div>';
    page.forEach(t => {
        html += '<div class="tablet-row" onclick="viewTablet(\'' + esc(t.textid) + '\')">';
        html += '<span class="tablet-title">' + esc(t.title || t.textid) + '</span>';
        html += '<span class="tablet-meta">' + esc(t.period || '-') + '</span>';
        html += '<span class="tablet-meta">' + esc(t.genre || '-') + '</span>';
        html += '<span class="tablet-meta">' + (t.total_lines || 0) + '</span>';
        html += '</div>';
    });
    area.innerHTML = html;

    let pHtml = '';
    if (totalPages > 1) {
        if (libPage > 1) pHtml += '<button class="page-btn" onclick="loadTablets(' + (libPage-1) + ')">&lt;</button>';
        pHtml += '<span class="page-btn active">' + libPage + ' / ' + totalPages + ' (' + total.toLocaleString() + ' total)</span>';
        if (libPage < totalPages) pHtml += '<button class="page-btn" onclick="loadTablets(' + (libPage+1) + ')">&gt;</button>';
    }
    document.getElementById('lib-pagination').innerHTML = pHtml;
}

// View individual tablet detail
function viewTablet(textid) {
    if (!tabletData) return;
    const t = tabletData.find(x => x.textid === textid);
    if (!t) return;
    const area = document.getElementById('library-results');
    let html = '<div class="word-detail">';
    html += '<h2>' + esc(t.title || t.textid) + '</h2>';
    html += '<div class="stats-grid" style="margin:1rem 0;">';
    html += '<div class="stat-box"><div class="stat-value text-gold">' + esc(t.textid) + '</div><div class="stat-label">Text ID</div></div>';
    html += '<div class="stat-box"><div class="stat-value text-gold">' + esc(t.corpus || '-') + '</div><div class="stat-label">Corpus</div></div>';
    html += '<div class="stat-box"><div class="stat-value text-gold">' + esc(t.period || '-') + '</div><div class="stat-label">Period</div></div>';
    html += '<div class="stat-box"><div class="stat-value text-gold">' + esc(t.genre || '-') + '</div><div class="stat-label">Genre</div></div>';
    html += '</div>';
    if (t.subgenre) html += '<p class="text-silver">Sub-genre: ' + esc(t.subgenre) + '</p>';
    if (t.provenience) html += '<p class="text-silver">Provenience: ' + esc(t.provenience) + '</p>';
    html += '<p class="text-silver">' + (t.total_lines || 0) + ' lines | ' + (t.total_words || 0) + ' words</p>';
    html += '</div>';
    html += '<button class="page-btn" onclick="renderTablets()" style="margin-top:0.5rem;">&lt; Back to library</button>';
    area.innerHTML = html;
}

// ---- Concordance tab ----
async function loadConcordanceData() {
    const area = document.getElementById('conc-results');
    area.innerHTML = '<p class="loading">Loading concordance index (48,080 words)...</p>';
    try {
        await ensureConcData();
        area.innerHTML = '<p class="loading">Concordance loaded. Search for a word to see its occurrences across all tablets.</p>';
    } catch(e) {
        area.innerHTML = '<p class="error-msg">Could not load concordance data.</p>';
    }
}

async function searchConcordance() {
    const q = document.getElementById('conc-search').value.trim().toLowerCase();
    const area = document.getElementById('conc-results');
    if (!q) return;
    area.innerHTML = '<p class="loading">Searching concordance...</p>';
    try {
        await ensureConcData();
        const results = concData.filter(r =>
            (r.lemma && r.lemma.toLowerCase().includes(q)) ||
            (r.gloss && r.gloss.toLowerCase().includes(q))
        ).slice(0, 10);

        if (results.length === 0) {
            area.innerHTML = '<p class="loading">No concordance results for "' + esc(q) + '"</p>';
            return;
        }
        let html = '';
        results.forEach(r => {
            let periods = r.period_json || {};
            if (typeof periods === 'string') try { periods = JSON.parse(periods); } catch(e) { periods = {}; }
            let maxCount = Math.max(...Object.values(periods), 1);

            html += '<div class="word-detail" style="margin-bottom:1.5rem;">';
            html += '<div style="display:flex;align-items:center;gap:1rem;">';
            html += '<div><h2 style="margin:0;">' + esc(r.lemma) + '</h2>';
            html += '<div class="gloss">' + esc(r.gloss || '') + '</div>';
            if (r.pos) html += '<div class="result-meta">' + esc(r.pos) + '</div>';
            html += '</div></div>';
            html += '<div class="stats-grid" style="margin:1rem 0;">';
            html += '<div class="stat-box"><div class="stat-value text-gold">' + (r.occurrence_count||0).toLocaleString() + '</div><div class="stat-label">Occurrences</div></div>';
            html += '<div class="stat-box"><div class="stat-value text-gold">' + (r.tablet_count||0).toLocaleString() + '</div><div class="stat-label">Tablets</div></div>';
            if (r.period_first_seen) html += '<div class="stat-box"><div class="stat-value text-gold" style="font-size:0.85rem;">' + esc(r.period_first_seen) + '</div><div class="stat-label">First Attested</div></div>';
            html += '</div>';

            Object.entries(periods).sort((a,b) => b[1]-a[1]).slice(0,8).forEach(([p,c]) => {
                let pct = Math.round((c/maxCount)*100);
                html += '<div class="period-bar"><span class="period-label">' + esc(p) + '</span>';
                html += '<div class="period-fill" style="width:' + pct + '%;"></div>';
                html += '<span class="period-count">' + c.toLocaleString() + '</span></div>';
            });
            html += '</div>';
        });
        area.innerHTML = html;
    } catch(e) {
        area.innerHTML = '<p class="error-msg">Concordance search failed.</p>';
    }
}

// ---- Initialize ----
loadStats();
</script>
</body>
</html>
